<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typing Game with Lanes</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: black;
        }

        canvas {
            display: block;
            width: 80vw;
            height: 100vh;
        }

        .menu {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            text-align: center;
            font-family: Arial, sans-serif;
            z-index: 10;
        }

        .menu button {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 24px;
            cursor: pointer;
            margin: 10px;
            border-radius: 5px;
        }

        .menu button:hover {
            background-color: #218838;
        }

        #scoreBoard, #levelBoard, #lives {
            position: absolute;
            top: 10px;
            color: white;
            font-size: 24px;
            font-family: Arial, sans-serif;
            z-index: 5;
        }

        #scoreBoard {
            left: 10px;
        }

        #levelBoard {
            left: 150px;
        }

        #lives {
            right: 10px;
        }

        .lostLife {
            color: red;
            font-weight: bold;
        }

        .gameOver {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 30px;
            font-family: Arial, sans-serif;
            text-align: center;
            z-index: 20;
            display: none;
        }
    </style>
</head>
<body>
    <div id="scoreBoard">Score: 0</div>
    <div id="levelBoard">Level: 1</div>
    <div id="lives">Lives: 5</div>
    <canvas id="gameCanvas"></canvas>
    <div class="menu" id="menu">
        <h1>Typing Game</h1>
        <button id="startButton">Start Game</button>
        <button id="closeButton">Close Game</button>
    </div>
    <div class="gameOver" id="gameOver">
        Game Over!<br>
        <button id="restartButton">Restart</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        function resizeCanvas() {
            canvas.width = window.innerWidth * 0.8;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        let words = ['sword', 'shield', 'enemy', 'battle', 'hero', 'apple', 'banana', 'grape'];
        let activeWords = [];
        let score = 0;
        let lives = 5;
        let level = 1;
        let lanes = [0, 1, 2, 3, 4];
        let laneHeight = canvas.height / lanes.length;
        let wordSpeed = 1;
        let speedIncrement = 0.5;
        let gameActive = false;
        let lastSpawnTime = 0;
        let isDizzy = false;
        const characterImages = {};
        const characterCount = 5; 
        const characterSize = canvas.height / 5;

        const backgroundImage = new Image();
        backgroundImage.src = 'https://images.unsplash.com/photo-1601370690183-1c7796ecec61?fm=jpg&q=60&w=3000&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxleHBsb3JlLWZlZWR8M3x8fGVufDB8fHx8fA%3D%3D';

        for (let i = 1; i <= characterCount; i++) {
            const img = new Image();
            img.src = `character${i}.png`; 
            characterImages[`character${i}`] = img;
        }

        function spawnWords() {
            const now = Date.now();
            if (now - lastSpawnTime > 4000) {
                let availableLane = lanes[Math.floor(Math.random() * lanes.length)];
                let wordObj = {
                    word: words[Math.floor(Math.random() * words.length)],
                    typed: '',
                    x: canvas.width,
                    y: availableLane * laneHeight + laneHeight / 2
                };
                activeWords.push(wordObj);
                lastSpawnTime = now;
            }
        }

        function drawCharacter(lane, isDizzy) {
            const img = characterImages[`character${lane + 1}`];
            const x = 0;
            const y = lane * laneHeight + laneHeight / 2;

            ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
            ctx.fillRect(x - 10, y - characterSize / 2, characterSize + 20, characterSize);

            if (img) {
                const shakeOffset = isDizzy ? (Math.sin(Date.now() / 100) * 5) : 0;
                ctx.drawImage(img, x + shakeOffset, y - characterSize / 2, characterSize, characterSize);
            }
        }

        function drawWords() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height);

            activeWords.forEach((wordObj) => {
                const { word, typed, x, y } = wordObj;

                for (let i = 0; i < word.length; i++) {
                    ctx.fillStyle = i < typed.length ? (word[i] === typed[i] ? 'green' : 'red') : 'white';
                    ctx.font = '50px Arial';
                    ctx.fillText(word[i], x + i * 40, y);
                }

                wordObj.x -= wordSpeed;

                if (wordObj.x < characterSize) {
                    const laneIndex = Math.floor(y / laneHeight);
                    if (laneIndex >= 0 && laneIndex < lanes.length) {
                        isDizzy = true;
                        lives--;
                        const livesElement = document.getElementById('lives');
                        livesElement.classList.add('lostLife');
                        setTimeout(() => livesElement.classList.remove('lostLife'), 500);
                        if (lives <= 0) {
                            gameOver();
                        }
                        activeWords.shift();
                    }
                }

                if (wordObj.x < -200) {
                    activeWords.shift();
                }
            });

            lanes.forEach(lane => drawCharacter(lane, isDizzy));
            isDizzy = false;

            document.getElementById('scoreBoard').innerText = 'Score: ' + score;
            document.getElementById('lives').innerText = 'Lives: ' + lives;
            document.getElementById('levelBoard').innerText = 'Level: ' + level;

            if (score > 0 && score % 10 === 0 && level < 10) {
                wordSpeed += speedIncrement;
                level = Math.floor(score / 10) + 1;
                score++;
            }
        }

        function gameLoop() {
            if (gameActive) {
                spawnWords();
                drawWords();
                requestAnimationFrame(gameLoop);
            }
        }

        function startGame() {
            document.getElementById('menu').style.display = 'none';
            gameActive = true;
            gameLoop();
        }

        function resetGame() {
            gameActive = false;
            document.getElementById('menu').style.display = 'block';
            activeWords = [];
            wordSpeed = 1;
            score = 0;
            lives = 5;
            level = 1;
            document.getElementById('gameOver').style.display = 'none';
        }

        function closeGame() {
            alert("Thank you for playing! Please close the tab manually.");
        }

        function gameOver() {
            gameActive = false;
            document.getElementById('gameOver').style.display = 'block';
        }

        document.getElementById('startButton').addEventListener('click', startGame);
        document.getElementById('closeButton').addEventListener('click', closeGame);
        document.getElementById('restartButton').addEventListener('click', resetGame);

        window.addEventListener('keydown', (e) => {
            if (gameActive && activeWords.length > 0) {
                let firstWord = activeWords[0];
                if (e.key === firstWord.word[firstWord.typed.length]) {
                    firstWord.typed += e.key;
                    score++;
                    if (firstWord.typed === firstWord.word) {
                        activeWords.shift();
                    }
                }
            }
        });
    </script>
</body>
</html>
